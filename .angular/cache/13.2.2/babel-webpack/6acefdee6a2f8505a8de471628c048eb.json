{"ast":null,"code":"// Copyright 2017 The Kubernetes Authors.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport { switchMap } from 'rxjs/operators';\nimport { AlertDialog } from '@common/dialogs/alert/dialog';\nimport { CsrfTokenService } from '@common/services/global/csrftoken';\nimport { CONFIG_DI_TOKEN } from '../../../../index.config';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@common/services/global/csrftoken\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"../helpsection/component\";\nimport * as i6 from \"@angular/material/form-field\";\nimport * as i7 from \"@angular/material/input\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"../helpsection/userhelp/component\";\nimport * as i10 from \"@angular/material/button\";\n\nfunction CreateNamespaceDialog_mat_error_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 16);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateNamespaceDialog_mat_error_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 17);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵi18nExp(ctx_r1.namespaceMaxLength);\n    i0.ɵɵi18nApply(1);\n  }\n}\n\nfunction CreateNamespaceDialog_mat_error_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 18);\n    i0.ɵɵelementEnd();\n  }\n}\n/**\n * Displays new namespace creation dialog.\n */\n\n\nexport let CreateNamespaceDialog = /*#__PURE__*/(() => {\n  class CreateNamespaceDialog {\n    constructor(dialogRef, data, http_, csrfToken_, matDialog_, fb_, appConfig_) {\n      this.dialogRef = dialogRef;\n      this.data = data;\n      this.http_ = http_;\n      this.csrfToken_ = csrfToken_;\n      this.matDialog_ = matDialog_;\n      this.fb_ = fb_;\n      this.appConfig_ = appConfig_;\n      /**\n       * Max-length validation rule for namespace\n       */\n\n      this.namespaceMaxLength = 63;\n      /**\n       * Pattern validation rule for namespace\n       */\n\n      this.namespacePattern = new RegExp('^[a-z0-9]([-a-z0-9]*[a-z0-9])?$');\n    }\n\n    ngOnInit() {\n      this.form = this.fb_.group({\n        namespace: ['', Validators.compose([Validators.maxLength(this.namespaceMaxLength), Validators.pattern(this.namespacePattern)])]\n      });\n    }\n\n    get namespace() {\n      return this.form.get('namespace');\n    }\n    /**\n     * Creates new namespace based on the state of the controller.\n     */\n\n\n    createNamespace() {\n      if (!this.form.valid) return;\n      const namespaceSpec = {\n        name: this.namespace.value\n      };\n      const tokenPromise = this.csrfToken_.getTokenForAction('namespace');\n      tokenPromise.pipe(switchMap(csrfToken => this.http_.post('api/v1/namespace', { ...namespaceSpec\n      }, {\n        headers: new HttpHeaders().set(this.appConfig_.csrfHeaderName, csrfToken.token)\n      }))).subscribe(() => {\n        this.dialogRef.close(this.namespace.value);\n      }, error => {\n        this.dialogRef.close();\n        const configData = {\n          title: 'Error creating namespace',\n          message: error.data,\n          confirmLabel: 'OK'\n        };\n        this.matDialog_.open(AlertDialog, {\n          data: configData\n        });\n      });\n    }\n    /**\n     * Returns true if new namespace name hasn't been filled by the user, i.e, is empty.\n     */\n\n\n    isDisabled() {\n      return this.data.namespaces.indexOf(this.namespace.value) >= 0;\n    }\n    /**\n     * Cancels the new namespace form.\n     */\n\n\n    cancel() {\n      this.dialogRef.close();\n    }\n\n  }\n\n  CreateNamespaceDialog.ɵfac = function CreateNamespaceDialog_Factory(t) {\n    return new (t || CreateNamespaceDialog)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA), i0.ɵɵdirectiveInject(i2.HttpClient), i0.ɵɵdirectiveInject(i3.CsrfTokenService), i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i4.FormBuilder), i0.ɵɵdirectiveInject(CONFIG_DI_TOKEN));\n  };\n\n  CreateNamespaceDialog.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CreateNamespaceDialog,\n    selectors: [[\"kd-create-namespace-dialog\"]],\n    decls: 28,\n    vars: 7,\n    consts: function () {\n      let i18n_0;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_6099594451254122208$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_1 = goog.getMsg(\"Create a new namespace\");\n        i18n_0 = MSG_EXTERNAL_6099594451254122208$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_1;\n      } else {\n        i18n_0 = $localize`Create a new namespace`;\n      }\n\n      let i18n_2;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_1853314835104660335$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_3 = goog.getMsg(\"The new namespace will be added to the cluster.\");\n        i18n_2 = MSG_EXTERNAL_1853314835104660335$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_3;\n      } else {\n        i18n_2 = $localize`The new namespace will be added to the cluster.`;\n      }\n\n      let i18n_4;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_6048882868784276224$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_5 = goog.getMsg(\"Namespace name\");\n        i18n_4 = MSG_EXTERNAL_6048882868784276224$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_5;\n      } else {\n        i18n_4 = $localize`Namespace name`;\n      }\n\n      let i18n_6;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_8711123012783083234$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_7 = goog.getMsg(\"A namespace with the specified name will be added to the cluster.\");\n        i18n_6 = MSG_EXTERNAL_8711123012783083234$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_7;\n      } else {\n        i18n_6 = $localize`A namespace with the specified name will be added to the cluster.`;\n      }\n\n      let i18n_8;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_33821194240460925$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_9 = goog.getMsg(\" Learn more {$startItalicText}open_in_new{$closeItalicText}\", {\n          \"startItalicText\": \"\\uFFFD#21\\uFFFD\",\n          \"closeItalicText\": \"\\uFFFD/#21\\uFFFD\"\n        });\n        i18n_8 = MSG_EXTERNAL_33821194240460925$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_9;\n      } else {\n        i18n_8 = $localize` Learn more ${\"\\uFFFD#21\\uFFFD\"}:START_ITALIC_TEXT:open_in_new${\"\\uFFFD/#21\\uFFFD\"}:CLOSE_ITALIC_TEXT:`;\n      }\n\n      let i18n_10;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_5674286808255988565$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_11 = goog.getMsg(\"Create\");\n        i18n_10 = MSG_EXTERNAL_5674286808255988565$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_11;\n      } else {\n        i18n_10 = $localize`Create`;\n      }\n\n      let i18n_12;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_2159130950882492111$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_13 = goog.getMsg(\"Cancel\");\n        i18n_12 = MSG_EXTERNAL_2159130950882492111$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS_13;\n      } else {\n        i18n_12 = $localize`Cancel`;\n      }\n\n      let i18n_14;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_4882930782066600379$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__15 = goog.getMsg(\" Name is required. \");\n        i18n_14 = MSG_EXTERNAL_4882930782066600379$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__15;\n      } else {\n        i18n_14 = $localize` Name is required. `;\n      }\n\n      let i18n_16;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_8504976263820600804$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__17 = goog.getMsg(\" Name must be up to {$interpolation} characters long. \", {\n          \"interpolation\": \"\\uFFFD0\\uFFFD\"\n        });\n        i18n_16 = MSG_EXTERNAL_8504976263820600804$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__17;\n      } else {\n        i18n_16 = $localize` Name must be up to ${\"\\uFFFD0\\uFFFD\"}:INTERPOLATION: characters long. `;\n      }\n\n      let i18n_18;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_5894033602013326468$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__19 = goog.getMsg(\" Name must be alphanumeric and may contain dashes. \");\n        i18n_18 = MSG_EXTERNAL_5894033602013326468$$SRC_APP_FRONTEND_CREATE_FROM_FORM_CREATENAMESPACE_DIALOG_TS__19;\n      } else {\n        i18n_18 = $localize` Name must be alphanumeric and may contain dashes. `;\n      }\n\n      return [[\"mat-dialog-title\", \"\"], i18n_0, [1, \"kd-dialog-text\"], i18n_2, [3, \"formGroup\"], [\"matInput\", \"\", \"type\", \"text\", \"placeholder\", i18n_4, \"name\", \"namespace\", \"formControlName\", \"namespace\", \"required\", \"\"], [\"align\", \"end\"], [4, \"ngIf\"], i18n_6, [\"href\", \"https://kubernetes.io/docs/admin/namespaces/\", \"target\", \"_blank\", \"tabindex\", \"-1\"], i18n_8, [1, \"material-icons\"], [\"mat-button\", \"\", \"type\", \"submit\", \"color\", \"primary\", 3, \"disabled\", \"click\"], i18n_10, [\"mat-button\", \"\", 3, \"click\"], i18n_12, i18n_14, i18n_16, i18n_18];\n    },\n    template: function CreateNamespaceDialog_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h4\", 0);\n        i0.ɵɵi18n(1, 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"mat-dialog-content\", 2);\n        i0.ɵɵelementContainerStart(3);\n        i0.ɵɵelementStart(4, \"div\");\n        i0.ɵɵi18n(5, 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\");\n        i0.ɵɵelementStart(7, \"form\", 4);\n        i0.ɵɵelementStart(8, \"kd-help-section\");\n        i0.ɵɵelementStart(9, \"mat-form-field\");\n        i0.ɵɵelement(10, \"input\", 5);\n        i0.ɵɵelementStart(11, \"mat-hint\", 6);\n        i0.ɵɵtext(12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, CreateNamespaceDialog_mat_error_13_Template, 2, 0, \"mat-error\", 7);\n        i0.ɵɵtemplate(14, CreateNamespaceDialog_mat_error_14_Template, 2, 1, \"mat-error\", 7);\n        i0.ɵɵtemplate(15, CreateNamespaceDialog_mat_error_15_Template, 2, 0, \"mat-error\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"kd-user-help\");\n        i0.ɵɵelementContainerStart(17);\n        i0.ɵɵi18n(18, 8);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementStart(19, \"a\", 9);\n        i0.ɵɵi18nStart(20, 10);\n        i0.ɵɵelement(21, \"i\", 11);\n        i0.ɵɵi18nEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"mat-dialog-actions\", 6);\n        i0.ɵɵelementContainerStart(23);\n        i0.ɵɵelementStart(24, \"button\", 12);\n        i0.ɵɵlistener(\"click\", function CreateNamespaceDialog_Template_button_click_24_listener() {\n          return ctx.createNamespace();\n        });\n        i0.ɵɵi18n(25, 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"button\", 14);\n        i0.ɵɵlistener(\"click\", function CreateNamespaceDialog_Template_button_click_26_listener() {\n          return ctx.cancel();\n        });\n        i0.ɵɵi18n(27, 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"formGroup\", ctx.form);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate2(\"\", ctx.namespace.value.length, \" / \", ctx.namespaceMaxLength, \"\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.namespace.errors == null ? null : ctx.namespace.errors.required);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.namespace.errors == null ? null : ctx.namespace.errors.maxlength);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.namespace.errors == null ? null : ctx.namespace.errors.pattern);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"disabled\", ctx.isDisabled());\n      }\n    },\n    directives: [i1.MatDialogTitle, i1.MatDialogContent, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.FormGroupDirective, i5.HelpSectionComponent, i6.MatFormField, i7.MatInput, i4.DefaultValueAccessor, i4.NgControlStatus, i4.FormControlName, i4.RequiredValidator, i6.MatHint, i8.NgIf, i6.MatError, i9.UserHelpComponent, i1.MatDialogActions, i10.MatButton],\n    encapsulation: 2\n  });\n  return CreateNamespaceDialog;\n})();","map":null,"metadata":{},"sourceType":"module"}