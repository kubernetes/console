{"ast":null,"code":"// Copyright 2017 The Kubernetes Authors.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { forwardRef } from '@angular/core';\nimport { AbstractControl, FormArray, FormBuilder, FormControl, FormGroup, NG_VALIDATORS, NG_VALUE_ACCESSOR, Validators } from '@angular/forms';\nimport { FormValidators } from '../validator/validators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/material/form-field\";\nimport * as i4 from \"@angular/flex-layout/flex\";\nimport * as i5 from \"@angular/material/input\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/icon\";\n\nfunction DeployLabelComponent_div_2_mat_error_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 14);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const label_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵi18nExp(label_r1.get(\"key\").value);\n    i0.ɵɵi18nApply(1);\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 15);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 16);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 17);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 18);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 19);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_mat_error_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 20);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_button_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function DeployLabelComponent_div_2_button_17_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.deleteLabel(i_r2);\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"delete\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction DeployLabelComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelementStart(1, \"mat-form-field\", 4);\n    i0.ɵɵelementStart(2, \"input\", 5);\n    i0.ɵɵlistener(\"keyup\", function DeployLabelComponent_div_2_Template_input_keyup_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const i_r2 = restoredCtx.index;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.check(i_r2);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, DeployLabelComponent_div_2_mat_error_3_Template, 2, 1, \"mat-error\", 6);\n    i0.ɵɵtemplate(4, DeployLabelComponent_div_2_mat_error_4_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵtemplate(5, DeployLabelComponent_div_2_mat_error_5_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵtemplate(6, DeployLabelComponent_div_2_mat_error_6_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵtemplate(7, DeployLabelComponent_div_2_mat_error_7_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"p\", 7);\n    i0.ɵɵelementStart(9, \"mat-form-field\", 8);\n    i0.ɵɵelementStart(10, \"input\", 9);\n    i0.ɵɵlistener(\"keyup\", function DeployLabelComponent_div_2_Template_input_keyup_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const i_r2 = restoredCtx.index;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.check(i_r2);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"mat-hint\", 10);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, DeployLabelComponent_div_2_mat_error_13_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵtemplate(14, DeployLabelComponent_div_2_mat_error_14_Template, 2, 0, \"mat-error\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"input\", 11);\n    i0.ɵɵelementStart(16, \"div\", 12);\n    i0.ɵɵtemplate(17, DeployLabelComponent_div_2_button_17_Template, 3, 0, \"button\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const label_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroupName\", i_r2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"readonly\", !label_r1.get(\"editable\").value);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"key\").errors == null ? null : label_r1.get(\"key\").errors.unique);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"key\").errors == null ? null : label_r1.get(\"key\").errors.kdValidLabelKeyPrefixPattern);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"key\").errors == null ? null : label_r1.get(\"key\").errors.kdValidLabelKeyNamePattern);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"key\").errors == null ? null : label_r1.get(\"key\").errors.kdValidLabelKeyPrefixLength);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"key\").errors == null ? null : label_r1.get(\"key\").errors.kdValidLabelKeyNameLength);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"readonly\", !label_r1.get(\"editable\").value);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", label_r1.get(\"value\").value == null ? null : label_r1.get(\"value\").value.length, \" / 253\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"value\").errors == null ? null : label_r1.get(\"value\").errors.kdValidLabelValuePattern);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", label_r1.get(\"value\").errors == null ? null : label_r1.get(\"value\").errors.maxlength);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isRemovable(i_r2));\n  }\n}\n\nexport let DeployLabelComponent = /*#__PURE__*/(() => {\n  class DeployLabelComponent {\n    constructor(fb_) {\n      this.fb_ = fb_;\n\n      this.propagateChange = _ => {};\n    }\n\n    ngOnInit() {\n      this.labelForm = this.fb_.group({\n        labels: this.fb_.array([])\n      });\n      this.labelForm.valueChanges.subscribe(v => {\n        this.propagateChange(v);\n      });\n\n      for (let i = 0; i < this.labelArr.length; i++) {\n        this.addNewLabel(this.labelArr[i].key, this.labelArr[i].value, this.labelArr[i].editable);\n      }\n    }\n\n    validate(_) {\n      return this.labelForm.valid ? null : {\n        labelValid: {\n          value: this.labels.at(0).errors\n        }\n      };\n    }\n\n    get labels() {\n      return this.labelForm.get('labels');\n    }\n    /**\n     * Adds row to labels list.\n     */\n\n\n    addNewLabel(key = '', value = '', editable = true) {\n      this.labels.push(this.fb_.group({\n        key: [{\n          value: key,\n          disabled: !editable\n        }, Validators.compose([FormValidators.labelKeyNameLength, FormValidators.labelKeyNamePattern, FormValidators.labelKeyPrefixLength, FormValidators.labelKeyPrefixPattern])],\n        value: [{\n          value,\n          disabled: !editable\n        }, Validators.compose([Validators.maxLength(253), FormValidators.labelValuePattern])],\n        editable\n      }));\n    }\n    /**\n     * Calls checks on label:\n     *  - adds label if last empty label has been filled\n     *  - checks for duplicated key and sets validity of element\n     */\n\n\n    check(index) {\n      this.addIfNeeded();\n      this.validateKey(index);\n    }\n    /**\n     * Returns true when label is editable and is not last on the list.\n     * Used to indicate whether delete icon should be shown near label.\n     */\n\n\n    isRemovable(index) {\n      const lastElement = this.labels.at(this.labels.length - 1);\n      const currentElement = this.labels.at(index);\n      const currentkey = currentElement.get('key').value;\n      const currentValue = currentElement.get('value').value;\n      const currentEditable = currentElement.get('editable').value;\n      const lastKey = lastElement.get('key').value;\n      const lastValue = lastElement.get('value').value;\n      return !!(currentEditable && currentkey !== lastKey && currentValue !== lastValue);\n    }\n    /**\n     * Deletes row from labels list.\n     */\n\n\n    deleteLabel(index) {\n      this.labels.removeAt(index);\n    }\n    /**\n     * Validates label within label form.\n     * Current checks:\n     *  - duplicated key\n     */\n\n\n    validateKey(index) {\n      const elem = this.labels.at(index).get('key');\n      const isUnique = !this.isKeyDuplicated(index);\n      elem.setErrors(isUnique ? null : {\n        unique: true\n      });\n      this.labelForm.updateValueAndValidity();\n    }\n    /**\n     * Returns true if there are 2 or more labels with the same key on the labelList,\n     * false otherwise.\n     */\n\n\n    isKeyDuplicated(index) {\n      /** @type {number} */\n      let duplications = 0;\n      const currentKey = this.labels.at(index).get('key').value;\n\n      for (let i = 0; i < this.labels.length; i++) {\n        const key = this.labels.at(i).get('key').value;\n\n        if (key.length !== 0 && key === currentKey) {\n          duplications++;\n        }\n\n        if (duplications > 1) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n    /**\n     * Adds label if last label key and value has been filled.\n     */\n\n\n    addIfNeeded() {\n      const lastLabel = this.labels.at(this.labels.length - 1);\n\n      if (this.isFilled(lastLabel)) {\n        this.addNewLabel();\n      }\n    }\n    /**\n     * Returns true if label key and value are not empty, false otherwise.\n     */\n\n\n    isFilled(label) {\n      return label.get('key').value.length !== 0 && label.get('value').value.length !== 0;\n    }\n\n    writeValue(labels) {\n      if (labels.length > 0) {\n        this.labels.at(labels[0].index).patchValue({\n          value: labels[0].value\n        });\n      }\n    }\n\n    registerOnChange(fn) {\n      this.propagateChange = fn;\n    }\n\n    registerOnTouched() {}\n\n  }\n\n  DeployLabelComponent.ɵfac = function DeployLabelComponent_Factory(t) {\n    return new (t || DeployLabelComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder));\n  };\n\n  DeployLabelComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DeployLabelComponent,\n    selectors: [[\"kd-deploy-label\"]],\n    inputs: {\n      labelArr: \"labelArr\"\n    },\n    features: [i0.ɵɵProvidersFeature([{\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => DeployLabelComponent),\n      multi: true\n    }, {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => DeployLabelComponent),\n      multi: true\n    }])],\n    decls: 3,\n    vars: 2,\n    consts: function () {\n      let i18n_0;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_2262782149902277587$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS__1 = goog.getMsg(\"key\");\n        i18n_0 = MSG_EXTERNAL_2262782149902277587$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS__1;\n      } else {\n        i18n_0 = $localize`key`;\n      }\n\n      let i18n_2;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_3375720161310377589$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS__3 = goog.getMsg(\"value\");\n        i18n_2 = MSG_EXTERNAL_3375720161310377589$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS__3;\n      } else {\n        i18n_2 = $localize`value`;\n      }\n\n      let i18n_4;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_3866570789762192209$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___5 = goog.getMsg(\" {$interpolation} is not unique \", {\n          \"interpolation\": \"\\uFFFD0\\uFFFD\"\n        });\n        i18n_4 = MSG_EXTERNAL_3866570789762192209$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___5;\n      } else {\n        i18n_4 = $localize` ${\"\\uFFFD0\\uFFFD\"}:INTERPOLATION: is not unique `;\n      }\n\n      let i18n_6;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_1147806662009464219$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___7 = goog.getMsg(\" Prefix is not a valid DNS subdomain prefix (eg. my-domain.com). \");\n        i18n_6 = MSG_EXTERNAL_1147806662009464219$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___7;\n      } else {\n        i18n_6 = $localize` Prefix is not a valid DNS subdomain prefix (eg. my-domain.com). `;\n      }\n\n      let i18n_8;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_6808882070524575121$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___9 = goog.getMsg(\" Label key name must be alphanumeric separated by '-', '_' or '.', optionally prefixed by a DNS subdomain and '/'. \");\n        i18n_8 = MSG_EXTERNAL_6808882070524575121$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___9;\n      } else {\n        i18n_8 = $localize` Label key name must be alphanumeric separated by '-', '_' or '.', optionally prefixed by a DNS subdomain and '/'. `;\n      }\n\n      let i18n_10;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_3577127417754184208$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___11 = goog.getMsg(\" Prefix should not exceed 253 characters. \");\n        i18n_10 = MSG_EXTERNAL_3577127417754184208$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___11;\n      } else {\n        i18n_10 = $localize` Prefix should not exceed 253 characters. `;\n      }\n\n      let i18n_12;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_7917378940749267344$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___13 = goog.getMsg(\" Label Key name should not exceed 63 characters. \");\n        i18n_12 = MSG_EXTERNAL_7917378940749267344$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___13;\n      } else {\n        i18n_12 = $localize` Label Key name should not exceed 63 characters. `;\n      }\n\n      let i18n_14;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_7680455819648699836$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___15 = goog.getMsg(\" Label value must be alphanumeric separated by '.' , '-' or '_'. \");\n        i18n_14 = MSG_EXTERNAL_7680455819648699836$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___15;\n      } else {\n        i18n_14 = $localize` Label value must be alphanumeric separated by '.' , '-' or '_'. `;\n      }\n\n      let i18n_16;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_3765016269314038530$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___17 = goog.getMsg(\" Label Value must not exceed 253 characters. \");\n        i18n_16 = MSG_EXTERNAL_3765016269314038530$$SRC_APP_FRONTEND_CREATE_FROM_FORM_DEPLOYLABEL_COMPONENT_TS___17;\n      } else {\n        i18n_16 = $localize` Label Value must not exceed 253 characters. `;\n      }\n\n      return [[3, \"formGroup\"], [\"formArrayName\", \"labels\"], [3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [3, \"formGroupName\"], [\"md-no-float\", \"\", \"fxFlex\", \"45\", 1, \"kd-deploy-input-row\"], [\"matInput\", \"\", \"name\", \"key\", \"formControlName\", \"key\", \"placeholder\", i18n_0, 3, \"readonly\", \"keyup\"], [4, \"ngIf\"], [\"fxFlex\", \"5\"], [\"md-no-float\", \"\", \"fxFlex\", \"40\", 1, \"kd-deploy-input-row\"], [\"matInput\", \"\", \"name\", \"value\", \"formControlName\", \"value\", \"placeholder\", i18n_2, 3, \"readonly\", \"keyup\"], [\"align\", \"end\"], [\"type\", \"hidden\", \"formControlName\", \"editable\"], [\"fxFlex\", \"10\"], [\"mat-icon-button\", \"\", 3, \"click\", 4, \"ngIf\"], i18n_4, i18n_6, i18n_8, i18n_10, i18n_12, i18n_14, i18n_16, [\"mat-icon-button\", \"\", 3, \"click\"]];\n    },\n    template: function DeployLabelComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementContainerStart(0, 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵtemplate(2, DeployLabelComponent_div_2_Template, 18, 12, \"div\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementContainerEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"formGroup\", ctx.labelForm);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.labels.controls);\n      }\n    },\n    directives: [i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormArrayName, i2.NgForOf, i1.FormGroupName, i3.MatFormField, i4.DefaultFlexDirective, i5.MatInput, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i2.NgIf, i3.MatError, i3.MatHint, i6.MatButton, i7.MatIcon],\n    encapsulation: 2\n  });\n  return DeployLabelComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}