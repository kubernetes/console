{"ast":null,"code":"// Copyright 2017 The Kubernetes Authors.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { forwardRef } from '@angular/core';\nimport { AbstractControl, FormArray, FormBuilder, FormControl, FormGroup, NG_VALIDATORS, NG_VALUE_ACCESSOR, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/flex-layout/flex\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/form-field\";\nimport * as i5 from \"@angular/material/input\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/icon\";\n\nfunction EnvironmentVariablesComponent_div_5_mat_error_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵi18n(1, 14);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction EnvironmentVariablesComponent_div_5_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function EnvironmentVariablesComponent_div_5_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.remove(i_r2);\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"delete\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction EnvironmentVariablesComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵelementStart(1, \"mat-form-field\", 7);\n    i0.ɵɵelementStart(2, \"input\", 8);\n    i0.ɵɵlistener(\"change\", function EnvironmentVariablesComponent_div_5_Template_input_change_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const i_r2 = restoredCtx.index;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.addVariableIfNeeed(i_r2);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, EnvironmentVariablesComponent_div_5_mat_error_3_Template, 2, 0, \"mat-error\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"div\", 10);\n    i0.ɵɵelementStart(5, \"mat-form-field\", 7);\n    i0.ɵɵelement(6, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 12);\n    i0.ɵɵtemplate(8, EnvironmentVariablesComponent_div_5_button_8_Template, 3, 0, \"button\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const variable_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroupName\", i_r2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", variable_r1.get(\"name\").errors == null ? null : variable_r1.get(\"name\").errors.pattern);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isRemovable(i_r2));\n  }\n}\n\nexport let EnvironmentVariablesComponent = /*#__PURE__*/(() => {\n  class EnvironmentVariablesComponent {\n    constructor(fb_) {\n      this.fb_ = fb_;\n      this.namePattern = new RegExp('^[A-Za-z_][A-Za-z0-9_]*$');\n\n      this.propagateChange = _ => {};\n    }\n\n    ngOnInit() {\n      this.form = this.fb_.group({\n        variables: this.fb_.array([this.newVariable()])\n      });\n      this.form.valueChanges.subscribe(v => {\n        this.propagateChange(v);\n      });\n    }\n\n    validate(_) {\n      return this.form.valid ? null : {\n        labelValid: {\n          value: this.form.errors\n        }\n      };\n    }\n\n    get variables() {\n      return this.form.get('variables');\n    }\n\n    addVariableIfNeeed() {\n      const last = this.variables.at(this.variables.length - 1);\n\n      if (this.isVariableFilled(last) && last.valid) {\n        this.variables.push(this.newVariable());\n      }\n    }\n\n    isVariableFilled(variable) {\n      return !!variable.get('name').value;\n    }\n\n    newVariable() {\n      return this.fb_.group({\n        name: ['', Validators.pattern(this.namePattern)],\n        value: ''\n      });\n    }\n\n    isRemovable(index) {\n      return index !== this.variables.length - 1;\n    }\n\n    remove(index) {\n      this.variables.removeAt(index);\n    }\n\n    writeValue() {}\n\n    registerOnChange(fn) {\n      this.propagateChange = fn;\n    }\n\n    registerOnTouched() {}\n\n  }\n\n  EnvironmentVariablesComponent.ɵfac = function EnvironmentVariablesComponent_Factory(t) {\n    return new (t || EnvironmentVariablesComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder));\n  };\n\n  EnvironmentVariablesComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EnvironmentVariablesComponent,\n    selectors: [[\"kd-environment-variables\"]],\n    features: [i0.ɵɵProvidersFeature([{\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => EnvironmentVariablesComponent),\n      multi: true\n    }, {\n      provide: NG_VALIDATORS,\n      useExisting: forwardRef(() => EnvironmentVariablesComponent),\n      multi: true\n    }])],\n    decls: 6,\n    vars: 2,\n    consts: function () {\n      let i18n_0;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_4708304467453184793$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS_1 = goog.getMsg(\"Environment variables\");\n        i18n_0 = MSG_EXTERNAL_4708304467453184793$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS_1;\n      } else {\n        i18n_0 = $localize`Environment variables`;\n      }\n\n      let i18n_2;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_8953033926734869941$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS__3 = goog.getMsg(\"Name\");\n        i18n_2 = MSG_EXTERNAL_8953033926734869941$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS__3;\n      } else {\n        i18n_2 = $localize`Name`;\n      }\n\n      let i18n_4;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_6555318547274416232$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS__5 = goog.getMsg(\"Value\");\n        i18n_4 = MSG_EXTERNAL_6555318547274416232$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS__5;\n      } else {\n        i18n_4 = $localize`Value`;\n      }\n\n      let i18n_6;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_3622321962461191178$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS___7 = goog.getMsg(\" Variable name must be a valid C identifier. \");\n        i18n_6 = MSG_EXTERNAL_3622321962461191178$$SRC_APP_FRONTEND_CREATE_FROM_FORM_ENVIRONMENTVARIABLES_COMPONENT_TS___7;\n      } else {\n        i18n_6 = $localize` Variable name must be a valid C identifier. `;\n      }\n\n      return [[\"fxLayout\", \"column\"], [1, \"kd-margin-bottom\"], i18n_0, [3, \"formGroup\"], [\"formArrayName\", \"variables\"], [3, \"formGroupName\", 4, \"ngFor\", \"ngForOf\"], [3, \"formGroupName\"], [\"fxFlex\", \"auto\"], [\"matInput\", \"\", \"name\", \"name\", \"formControlName\", \"name\", \"placeholder\", i18n_2, 3, \"change\"], [4, \"ngIf\"], [\"fxFlex\", \"5\"], [\"matInput\", \"\", \"name\", \"value\", \"formControlName\", \"value\", \"placeholder\", i18n_4], [\"fxFlex\", \"10\"], [\"mat-icon-button\", \"\", 3, \"click\", 4, \"ngIf\"], i18n_6, [\"mat-icon-button\", \"\", 3, \"click\"]];\n    },\n    template: function EnvironmentVariablesComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵi18n(2, 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementContainerStart(3, 3);\n        i0.ɵɵelementContainerStart(4, 4);\n        i0.ɵɵtemplate(5, EnvironmentVariablesComponent_div_5_Template, 9, 3, \"div\", 5);\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.form);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.variables.controls);\n      }\n    },\n    directives: [i2.DefaultLayoutDirective, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormArrayName, i3.NgForOf, i1.FormGroupName, i4.MatFormField, i2.DefaultFlexDirective, i5.MatInput, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i3.NgIf, i4.MatError, i6.MatButton, i7.MatIcon],\n    encapsulation: 2\n  });\n  return EnvironmentVariablesComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}